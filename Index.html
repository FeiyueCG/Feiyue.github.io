<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上传图片和视频</title>
</head>
<body>
    <h2>上传图片和视频</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="fileUpload">选择文件（图片或视频）：</label>
        <input type="file" id="fileUpload" name="fileUpload" accept="image/*,video/*" multiple>
        <br><br>
        <input type="button" value="保存" onclick="saveFiles()">
    </form>
    <div id="previewContainer"></div>

    <script>
        document.getElementById('fileUpload').addEventListener('change', function(event) {
            const files = event.target.files;
            const previewContainer = document.getElementById('previewContainer');

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileType = file.type.split('/')[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    const preview = document.createElement(fileType === 'image' ? 'img' : 'video');
                    preview.src = e.target.result;
                    preview.style.maxWidth = '200px';
                    preview.style.maxHeight = '200px';
                    preview.style.cursor = 'pointer';
                    if (fileType === 'video') {
                        preview.controls = true;
                    }

                    preview.addEventListener('click', function() {
                        if (preview.requestFullscreen) {
                            preview.requestFullscreen();
                        } else if (preview.webkitRequestFullscreen) { // Safari
                            preview.webkitRequestFullscreen();
                        } else if (preview.msRequestFullscreen) { // IE/Edge
                            preview.msRequestFullscreen();
                        }
                    });

                    previewContainer.appendChild(preview);
                };

                reader.readAsDataURL(file);
            }
        });

        function saveFiles() {
            const files = document.getElementById('fileUpload').files;
            const savedFiles = JSON.parse(localStorage.getItem('savedFiles')) || [];

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();

                reader.onload = function(e) {
                    savedFiles.push({
                        name: file.name,
                        type: file.type,
                        data: e.target.result
                    });

                    if (savedFiles.length === files.length) {
                        localStorage.setItem('savedFiles', JSON.stringify(savedFiles));
                        alert('文件已保存！');
                        displaySavedFiles();
                    }
                };

                reader.readAsDataURL(file);
            }
        }

        function displaySavedFiles() {
            const savedFiles = JSON.parse(localStorage.getItem('savedFiles')) || [];
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = ''; // 清空之前的预览内容

            savedFiles.forEach(file => {
                const preview = document.createElement(file.type.split('/')[0] === 'image' ? 'img' : 'video');
                preview.src = file.data;
                preview.style.maxWidth = '200px';
                preview.style.maxHeight = '200px';
                preview.style.cursor = 'pointer';
                if (file.type.split('/')[0] === 'video') {
                    preview.controls = true;
                }

                preview.addEventListener('click', function() {
                    if (preview.requestFullscreen) {
                        preview.requestFullscreen();
                    } else if (preview.webkitRequestFullscreen) { // Safari
                        preview.webkitRequestFullscreen();
                    } else if (preview.msRequestFullscreen) { // IE/Edge
                        preview.msRequestFullscreen();
                    }
                });

                previewContainer.appendChild(preview);
            });
        }

        // 页面加载时显示已保存的文件
        window.onload = displaySavedFiles;
    </script>
</body>
</html>
